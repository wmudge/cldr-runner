---

# kitchen sink

version: 1

build_arg_defaults:
  EE_BASE_IMAGE: 'quay.io/ansible/ansible-runner:stable-2.10-latest'

#ansible_config: 'ansible.cfg'

dependencies:
  galaxy: payload/deps/ansible.yml
  python: payload/deps/python_base.txt
  system: ee-bindep.txt

additional_build_steps:
  prepend: |
    RUN whoami
    RUN cat /etc/os-release
    RUN rpm --import https://packages.microsoft.com/keys/microsoft.asc \
      && cp /runner/deps/*.repo /etc/yum.repos.d/ \
      && dnf clean expire-cache \
  append: |
    RUN echo This is a post-install command!
    RUN ls -la /etc
    RUN echo "Purging Pip cache" && pip cache purge || echo "No Pip cache to purge"
    RUN echo "Cleaning dnf/yum cache" && dnf clean all
    RUN rm -rf /var/cache/yum
    RUN rm -rf /var/cache/dnf
